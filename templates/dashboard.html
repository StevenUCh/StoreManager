{% extends 'base.html' %}
{% block content %}

<h2 class="text-2xl font-semibold text-center mb-6 dark:text-gray-100">ðŸ“Š Dashboard</h2>

<!-- Tarjetas resumen -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 text-center">
    <h6 class="text-sm text-gray-500 dark:text-gray-400">Ingresos</h6>
    <h3 class="text-2xl font-bold text-green-500">{{ ingresos|currency }}</h3>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 text-center">
    <h6 class="text-sm text-gray-500 dark:text-gray-400">Gastos</h6>
    <h3 class="text-2xl font-bold text-red-500">{{ gastos|currency }}</h3>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 text-center">
    <h6 class="text-sm text-gray-500 dark:text-gray-400">Pagos</h6>
    <h3 class="text-2xl font-bold text-blue-500">{{ pagos|currency }}</h3>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 text-center">
    <h6 class="text-sm text-gray-500 dark:text-gray-400">Balance</h6>
    <h3 class="text-2xl font-bold text-indigo-500">{{ balance|currency }}</h3>
  </div>
</div>

<!-- ======================= -->
<!-- MOVIMIENTOS (CON AJAX) -->
<!-- ======================= -->

<div id="tabla-movimientos">
  {% include "dashboard_table.html" %}
</div>

<!-- Deudas por persona -->
<div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 mb-8 overflow-x-auto">
  <h5 class="text-lg font-semibold mb-3 dark:text-gray-100">Deudas por persona</h5>

  <table class="w-full text-sm text-left text-gray-600 dark:text-gray-300">
    <thead class="bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200">
      <tr>
        <th class="px-3 py-2 text-center">Persona</th>
        <th class="px-3 py-2 text-center">Monto Debe</th>
        <th class="px-3 py-2 text-center">Monto Pagado</th>
        <th class="px-3 py-2 text-center">Le Deben</th>
        <th class="px-3 py-2 text-center">Saldo a Favor</th>
        <th class="px-3 py-2 text-center">Balance Neto</th>
      </tr>
    </thead>
    <tbody>
      {% for item in deudas %}
      <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
        <td class="px-3 py-2 text-center">{{ item.person.name }}</td>
        <td class="px-3 py-2 text-center">{{ item.debe | currency }}</td>
        <td class="px-3 py-2 text-center">{{ item.pagado | currency }}</td>
        <td class="px-3 py-2 text-center font-semibold 
                    {% if item.le_deben > 0 %} text-green-600 
                   {% elif item.le_deben < 0 %} text-red-600 
                   {% else %} text-gray-500 {% endif %}">
          {{ item.le_deben | currency }}
        </td>
        <td class="px-3 py-2 text-center font-semibold 
                    {% if item.saldo_favor > 0 %} text-blue-600 
                   {% elif item.saldo_favor < 0 %} text-red-600 
                   {% else %} text-gray-500 {% endif %}">
          {{ item.saldo_favor | currency }}
        </td>
        <td class="px-3 py-2 text-center font-semibold 
                    {% if item.balance > 0 %} text-green-600 
                   {% elif item.balance < 0 %} text-red-600 
                   {% else %} text-gray-500 {% endif %}">
          {{ item.balance | currency }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4 text-sm dark:text-gray-100">
    <p>ðŸ’¸ Deben en total: <strong>{{ total_deuda | currency }}</strong></p>
  </div>
</div>

<!-- GrÃ¡ficas -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
    <h5 class="text-lg font-semibold mb-2 dark:text-gray-100">Ingresos vs Gastos</h5>
    <canvas id="chartIngresosGastos" class="w-full h-64"></canvas>
  </div>
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4">
    <h5 class="text-lg font-semibold mb-2 dark:text-gray-100">Gastos por CategorÃ­a</h5>
    <canvas id="chartCategorias" class="w-full h-64"></canvas>
  </div>
</div>

<script>
  const ingresosGastosData = {{ ingresos_gastos_data|tojson }};
  const categoriasData = {{ categorias_data|tojson }};
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% endblock %}
